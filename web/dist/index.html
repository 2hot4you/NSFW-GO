<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSFW-Go 智能影视库</title>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Design System -->
    <link rel="stylesheet" href="static/css/design-system.css">
    <style>
        /* 仪表盘特定样式 */
        .hero-section {
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-lg);
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero-content {
            position: relative;
            z-index: 10;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #fff, #a5b4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero-subtitle {
            font-size: 1.125rem;
            color: #c7d2fe;
            max-width: 600px;
            line-height: 1.6;
        }

        .hero-bg-icon {
            position: absolute;
            right: -50px;
            bottom: -50px;
            font-size: 15rem;
            color: rgba(255, 255, 255, 0.03);
            transform: rotate(-15deg);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title i {
            color: var(--primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .action-card {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 1.5rem;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .action-icon {
            width: 56px;
            height: 56px;
            border-radius: var(--radius-lg);
            background: var(--bg-card-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
            transition: all var(--duration-fast);
        }

        .action-card:hover .action-icon {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .action-info h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .action-info p {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- 侧边栏将由 sidebar.js 注入 -->

    <main class="main-content">
        <!-- 顶部栏 (移动端菜单开关等) -->
        <header class="flex items-center justify-between mb-8 hide-mobile">
            <!-- 面包屑或标题 -->
            <div class="text-muted text-sm">
                首页 / 仪表盘
            </div>
            <!-- 右侧工具栏 -->
            <div class="flex items-center gap-4">
                <button class="btn btn-icon btn-ghost" onclick="checkSystem()">
                    <i class="fas fa-stethoscope"></i>
                </button>
                <button class="btn btn-icon btn-ghost" onclick="refreshStats()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </header>

        <!-- Hero 区域 -->
        <section class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">欢迎回来，指挥官</h1>
                <p class="hero-subtitle">
                    NSFW-Go 智能影视库管理系统已就绪。目前系统运行平稳，爬虫引擎待命，本地媒体库索引已更新。
                </p>
                <div class="mt-6 flex gap-3">
                    <a href="/search.html" class="btn btn-primary">
                        <i class="fas fa-search"></i>
                        立即搜索
                    </a>
                    <a href="/local-movies.html" class="btn btn-secondary">
                        <i class="fas fa-folder-open"></i>
                        浏览本地库
                    </a>
                </div>
            </div>
            <i class="fas fa-film hero-bg-icon"></i>
        </section>

        <!-- 统计概览 -->
        <section>
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    库藏概览
                </h2>
            </div>
            <div class="stats-grid" id="statsContainer">
                <!-- 骨架屏 -->
                <div class="card stat-card">
                    <div class="icon-wrapper"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="value">---</div>
                    <div class="label">加载中...</div>
                </div>
                <div class="card stat-card">
                    <div class="icon-wrapper"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="value">---</div>
                    <div class="label">加载中...</div>
                </div>
                <div class="card stat-card">
                    <div class="icon-wrapper"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="value">---</div>
                    <div class="label">加载中...</div>
                </div>
                <div class="card stat-card">
                    <div class="icon-wrapper"><i class="fas fa-spinner fa-spin"></i></div>
                    <div class="value">---</div>
                    <div class="label">加载中...</div>
                </div>
            </div>
        </section>

        <!-- 快速入口 -->
        <section>
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-rocket"></i>
                    快速入口
                </h2>
            </div>
            <div class="actions-grid">
                <a href="/search.html" class="card action-card">
                    <div class="action-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="action-info">
                        <h3>全库搜索</h3>
                        <p>支持番号、女优、关键词智能搜索</p>
                    </div>
                </a>

                <a href="/rankings.html" class="card action-card">
                    <div class="action-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="action-info">
                        <h3>热门排行</h3>
                        <p>查看 JAVDb 日榜、周榜趋势</p>
                    </div>
                </a>

                <a href="/config.html" class="card action-card">
                    <div class="action-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <div class="action-info">
                        <h3>系统配置</h3>
                        <p>管理爬虫、网络及存储设置</p>
                    </div>
                </a>

                <a href="/local-movies.html" class="card action-card">
                    <div class="action-icon">
                        <i class="fas fa-server"></i>
                    </div>
                    <div class="action-info">
                        <h3>本地管理</h3>
                        <p>整理和维护本地已下载影片</p>
                    </div>
                </a>
            </div>
        </section>
    </main>

    <!-- 脚本 -->
    <script src="static/js/sidebar.js"></script>
    <script src="static/js/components.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadSystemStats();
        });

        async function loadSystemStats() {
            const container = document.getElementById('statsContainer');
            try {
                const response = await fetch('/api/v1/stats');
                const data = await response.json();
                
                if (data.code === 'SUCCESS' && data.data) {
                    renderStats(data.data);
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
                container.innerHTML = '<div class="text-muted p-4">加载统计失败</div>';
            }
        }

        function renderStats(data) {
            const container = document.getElementById('statsContainer');
            const stats = [
                { title: '本地影片', value: data.local_movies || 0, icon: 'fas fa-hdd' },
                { title: '今日收录', value: data.daily_local || 0, icon: 'fas fa-calendar-day' },
                { title: '本周收录', value: data.weekly_local || 0, icon: 'fas fa-calendar-week' },
                { title: '本月收录', value: data.monthly_local || 0, icon: 'fas fa-calendar-alt' }
            ];

            container.innerHTML = stats.map(stat => `
                <div class="card stat-card">
                    <div class="icon-wrapper">
                        <i class="${stat.icon}"></i>
                    </div>
                    <div class="value">${stat.value}</div>
                    <div class="label">${stat.title}</div>
                </div>
            `).join('');
        }

        async function checkSystem() {
            // 简单的系统检查反馈
            const btn = document.querySelector('button[onclick="checkSystem()"] i');
            btn.classList.add('fa-spin');
            try {
                await fetch('/health');
                alert('系统运行正常');
            } catch (e) {
                alert('系统连接异常');
            } finally {
                btn.classList.remove('fa-spin');
            }
        }

        function refreshStats() {
            const btn = document.querySelector('button[onclick="refreshStats()"] i');
            btn.classList.add('fa-spin');
            loadSystemStats().then(() => {
                setTimeout(() => btn.classList.remove('fa-spin'), 500);
            });
        }
    </script>
</body>
</html>
