# NSFW-Go 智能成人影视库管理系统

> 基于Go + Vue3的现代化JAV影片管理平台，支持本地影视库管理、JAVDb在线搜索、排行榜爬取和智能数据分析

## 🎯 项目概述

NSFW-Go是一个专为管理成人影视内容设计的全栈Web应用，集成了本地影视库管理、在线数据搜索、排行榜爬取、智能分析等功能。系统采用现代化架构，具备高性能、简洁易用、功能完善的特点。

### 🏗️ 技术架构

- **后端**: Go 1.23+ + Gin + GORM + PostgreSQL + Redis
- **前端**: 原生JavaScript + Tailwind CSS + 现代化响应式设计
- **数据库**: PostgreSQL 15+ (主库) + Redis 7+ (缓存)
- **爬虫**: Colly + 多站点支持 (JAVDb, JAVLibrary等)
- **部署**: 原生部署 / Docker支持

## 📊 当前状态 (Phase 1-4 已完成 ✅)

### ✅ 已完成功能

#### 🔧 核心基础设施
- [x] Go 1.23.9 开发环境搭建
- [x] 完整项目结构设计 (`cmd/`, `internal/`, `web/`, `migrations/`)
- [x] 配置管理系统 (支持YAML配置文件和环境变量)
- [x] 数据库连接池和迁移系统
- [x] Redis缓存集成
- [x] Docker Compose 部署配置
- [x] Makefile 构建和管理脚本

#### 💾 数据库系统
- [x] PostgreSQL 15 数据库运行 (端口5432)
- [x] Redis 7 缓存服务运行 (端口6379)
- [x] 精简的数据模型设计 (本地影片、排行榜)
- [x] 数据库自动迁移和回滚
- [x] 支持PostgreSQL数组类型和JSON字段
- [x] 全文搜索索引和性能优化

#### 🚀 后端API服务
- [x] Gin Web框架集成和中间件配置
- [x] RESTful API设计和路由管理
- [x] Repository模式数据访问层
- [x] 高级分页、筛选和排序
- [x] 全文搜索功能 (番号、标题)
- [x] 统计信息API
- [x] 错误处理和日志记录
- [x] API响应标准化

#### 🎨 简洁现代化界面  
- [x] **极简设计理念** - 移除复杂功能，专注核心体验
- [x] **响应式Web界面** - Tailwind CSS + FontAwesome，完全适配移动端
- [x] **现代化主页** - 深色主题，动态状态指示器，实时统计数据
- [x] **统一导航栏** - 简化的导航设计，只保留核心功能
- [x] **去除冗余功能** - 移除暗黑模式切换、通知系统、用户下拉框等
- [x] **搜索优先体验** - 专门的搜索页面，支持多种搜索模式

#### 📁 本地影视库管理系统 ✅ **完成!**
- [x] **本地影片扫描**: 自动扫描 `/MediaCenter/NSFW/Hub/#Done` 目录
- [x] **数据库模型**: `LocalMovie` 模型，包含路径、大小、格式等完整信息
- [x] **定时扫描服务**: 每15分钟自动扫描本地影视库更新
- [x] **性能优化**: API响应时间从30s优化到3ms (提升10,000倍)
- [x] **Fanart图片支持**: 自动检测和显示影片封面图
- [x] **中文字符编码**: 完美支持中文路径和文件名
- [x] **实时影片信息**: 显示498部本地影片的完整信息
- [x] **高性能图片服务**: 安全的图片URL编码和解码
- [x] **数据缓存策略**: 避免每次请求都扫描文件系统
- [x] **现代化界面**: 统一的卡片式布局，深色主题设计

#### 🏆 JAVDb排行榜爬虫系统 ✅ **完成!**
- [x] **专业爬虫引擎**: 基于Colly的高性能爬虫框架
- [x] **多类型排行榜**: 支持日榜、周榜、月榜三种排行类型
- [x] **定时自动爬取**: 每日12:00自动爬取最新排行榜数据
- [x] **智能本地匹配**: 每小时自动对比本地498部影片
- [x] **数据持久化**: Ranking模型存储排行榜数据和本地存在状态
- [x] **手动触发功能**: 支持手动爬取和本地检查触发
- [x] **现代化界面**: 卡片式布局，多类型切换，实时统计展示
- [x] **API集成**: 完整的REST API支持，包含统计和筛选功能

#### 🔍 JAVDb在线搜索系统 🎯 **NEW!**
- [x] **实时搜索功能**: 基于JAVDb的在线影片搜索
- [x] **智能评分解析**: 准确提取"4.5分, 由2355人評價"格式的评分数据
- [x] **完整影片信息**: 番号、标题、封面、评分、发行日期、详情链接
- [x] **专用搜索页面**: 独立的搜索界面，支持本地和在线搜索切换
- [x] **统一布局设计**: 与本地影片管理界面保持一致的网格布局
- [x] **评分徽章显示**: 右上角橙色评分徽章，带星星图标
- [x] **API接口**: `/api/v1/search/javdb?q=番号&type=movie`
- [x] **智能番号匹配**: 支持多种番号格式的精确匹配
- [x] **深色主题统一**: 与系统整体主题保持一致

#### 🏃‍♂️ 性能优化成果 🚀
| 功能 | 优化前 | 优化后 | 提升倍数 |
|------|--------|--------|----------|
| 统计API | ~30秒 | 3.1ms | **10,000x** |
| 影片列表 | ~30秒 | 3.7ms | **8,000x** |
| 图片加载 | N/A | 20-150ms | **流畅体验** |
| JAVDb搜索 | N/A | ~1秒 | **实时响应** |
| 扫描方式 | 每次请求 | 15分钟定时 | **避免重复扫描** |

### 🌐 可用服务

| 服务 | 地址 | 状态 | 说明 |
|------|------|------|------|
| **主页** | http://localhost:8080 | ✅ 运行中 | 现代化主要管理界面 🎨 |
| **搜索中心** | http://localhost:8080/search.html | ✅ 运行中 | 统一搜索界面 🆕 |
| **本地影视库** | http://localhost:8080/local-movies.html | ✅ 运行中 | 本地影片管理 🎨 |
| **排行榜系统** | http://localhost:8080/rankings.html | ✅ 运行中 | JAVDb排行榜浏览 ✅ |
| **API服务** | http://localhost:8080/api/v1 | ✅ 运行中 | RESTful API |
| **健康检查** | http://localhost:8080/health | ✅ 运行中 | 服务状态检查 |

### 📱 API端点列表

#### JAVDb在线搜索 🆕
```bash
# JAVDb影片搜索
GET /api/v1/search/javdb?q=SONE-162&type=movie

# 响应示例
{
  "success": true,
  "data": {
    "code": "SONE-162",
    "title": "キレかわ清楚の女子●生を我慢できずに...",
    "cover_url": "https://...",
    "rating": 4.5,
    "release_date": "2024-xx-xx",
    "detail_url": "https://javdb.com/v/..."
  }
}
```

#### 统一搜索接口
```bash
# 统一搜索 (本地+排行榜)
GET /api/v1/search/?q=SONE&type=all&page=1&limit=20

# 搜索建议
GET /api/v1/search/suggestions?q=SONE
```

#### 本地影视库管理
```bash
# 本地影片列表 (支持分页、按女优筛选)
GET /api/v1/local/movies?page=1&limit=50&actress=葵つかさ

# 本地影片统计
GET /api/v1/local/stats

# 手动触发扫描
POST /api/v1/local/scan

# 图片服务 (安全URL编码)
GET /api/v1/local/image/{encoded_path}
```

#### 排行榜系统
```bash
# 获取排行榜 (支持类型筛选和分页)
GET /api/v1/rankings?type=daily&limit=20&page=1

# 排行榜统计信息
GET /api/v1/rankings/stats

# 获取本地已存在的排行榜影片
GET /api/v1/rankings/local?limit=10

# 手动触发爬取
POST /api/v1/rankings/crawl

# 手动触发本地检查
POST /api/v1/rankings/check
```

#### 系统信息
```bash
# 系统统计 (包含所有模块数据)
GET /api/v1/stats

# 健康检查
GET /health
```

## 📝 最近更新记录

### 🔍 2025-07-02: JAVDb在线搜索功能完成
**目标**: 实现完整的JAVDb在线搜索功能，提供实时影片信息查询

#### 🚀 核心功能:
1. **JAVDb搜索引擎**: 基于Colly框架的专业搜索爬虫
2. **智能评分解析**: 使用正则表达式准确提取"4.5分, 由2355人評價"格式数据
3. **完整影片信息**: 番号、标题、封面、评分、发行日期、详情链接
4. **专用搜索页面**: 独立的搜索界面，支持本地和JAVDb搜索切换

#### 🎨 界面优化:
1. **统一搜索体验**: 专门的搜索页面，整合本地和在线搜索
2. **布局统一**: JAVDb搜索结果使用与本地影片相同的网格布局
3. **评分徽章**: 右上角橙色评分徽章，带星星图标，增强视觉效果
4. **深色主题**: 完全统一的深色主题设计

#### 🛠️ 技术实现:
```go
// 核心文件
internal/service/javdb_service.go    // JAVDb搜索服务
internal/api/handlers/search.go      // 搜索API处理器
web/dist/search.html                 // 统一搜索页面
web/dist/static/js/search.js         // 搜索JavaScript逻辑
```

#### ✅ 解决的问题:
- **评分显示为0**: 修复评分解析逻辑，正确提取数字部分
- **布局不统一**: 统一所有影片卡片的网格布局
- **评分徽章不显示**: 增强视觉效果，添加z-index和阴影
- **应用重启问题**: 确保代码更改后正确重启应用

### 🎨 2025-06-11: 系统界面简化 + 排行榜系统完成
**目标**: 简化界面设计，移除不必要功能，专注核心体验

#### 🗑️ 系统简化:
1. **移除复杂功能**: 删除暗黑模式切换、通知系统、用户下拉框
2. **导航栏简化**: 只保留核心导航链接：首页、本地影片、排行榜、搜索、设置
3. **代码清理**: 移除相关JavaScript和CSS，提升系统性能
4. **专注核心**: 聚焦本地影视库管理和在线搜索功能

#### 🎨 界面重构:
1. **现代化设计**: 采用深色主题，玻璃态效果，现代化卡片设计
2. **响应式优化**: 桌面端显示完整导航，移动端显示图标导航
3. **统一布局**: 所有页面使用一致的设计语言和组件
4. **搜索优先**: 专门的搜索页面，提升搜索体验

#### 🏆 排行榜系统完成:
1. **JAVDb爬虫**: 自动爬取日榜、周榜、月榜数据
2. **定时任务**: 每日12:00自动爬取，每小时检查本地匹配
3. **智能匹配**: 自动对比498部本地影片，标记已存在影片
4. **现代化界面**: 卡片式布局，多类型切换，实时数据展示

### 🎯 2025-06-11: 本地影视库管理系统完成
**目标**: 实现高性能本地影视库管理，解决实时扫描性能问题

#### ✅ 解决的问题:
- **性能问题**: API响应时间从30秒优化到3毫秒
- **重复扫描**: 每次请求都扫描文件系统 → 定时后台扫描
- **中文支持**: URL编码问题导致中文路径无法访问
- **用户体验**: 页面卡顿 → 毫秒级响应

#### 🎯 成果数据:
- **扫描影片**: 498部本地影片
- **扫描时间**: 6.28秒 (一次性)
- **API响应**: 3ms平均响应时间
- **自动化**: 15分钟定时更新
- **图片支持**: 完整的fanart图片系统

## 🚧 开发规划

### 📋 Phase 5: 搜索功能增强 (当前阶段 🎯)

#### 🔍 搜索体验优化
- [x] **JAVDb基础搜索**: 实现基本的影片信息搜索 ✅
- [x] **评分功能**: 准确解析和显示评分信息 ✅
- [x] **统一界面**: 搜索结果布局与本地影片保持一致 ✅
- [ ] **分页功能**: 实现JAVDb搜索结果分页显示
- [ ] **搜索过滤**: 按评分、发行日期、制作商等筛选
- [ ] **搜索建议**: 自动完成和搜索历史记录
- [ ] **缓存机制**: 搜索结果缓存，提升响应速度

#### 🎯 本地匹配功能
- [ ] **智能匹配**: JAVDb搜索结果与本地影片的匹配显示
- [ ] **状态标识**: 在搜索结果中标识哪些影片已在本地
- [ ] **愿望清单**: 添加感兴趣影片到愿望清单功能
- [ ] **批量操作**: 批量添加到愿望清单等操作

#### 📊 数据整合
- [ ] **多源搜索**: 整合JAVDb、JAVLibrary等多个数据源
- [ ] **数据融合**: 不同源的数据合并和去重
- [ ] **数据质量**: 数据准确性验证和修正
- [ ] **增量更新**: 定期更新影片信息

### 📋 Phase 6: 下载管理系统

#### ⬇️ 下载引擎
- [ ] **多线程下载**: 支持并发下载多个文件
- [ ] **断点续传**: 支持下载中断后继续
- [ ] **下载队列**: 优先级队列管理
- [ ] **进度监控**: 实时下载进度显示
- [ ] **速度限制**: 带宽控制和调度
- [ ] **自动重试**: 下载失败自动重试机制

#### 📁 文件管理
- [ ] **智能命名**: 按规则自动重命名文件
- [ ] **目录整理**: 按女优/制作商/日期分类存储
- [ ] **重复检测**: 避免下载重复文件
- [ ] **存储空间监控**: 磁盘空间检查和清理
- [ ] **文件校验**: MD5/SHA256完整性检查

### 📋 Phase 7: 高级功能

#### 🧠 智能推荐
- [ ] **推荐算法**: 基于本地库的内容推荐
- [ ] **相似影片**: 基于标签和女优的相似度计算
- [ ] **热门趋势**: 基于排行榜的趋势分析
- [ ] **个性化**: 用户偏好学习和个性化推荐

#### 🎬 媒体预览
- [ ] **视频预览**: 在线视频播放器集成
- [ ] **截图预览**: 自动生成影片截图
- [ ] **字幕支持**: 多语言字幕显示
- [ ] **播放记录**: 播放位置记忆功能

#### 🤖 自动化功能
- [ ] **定时任务优化**: 更智能的爬取和扫描策略
- [ ] **数据清理**: 自动清理过期和无效数据
- [ ] **系统监控**: 性能监控和告警机制
- [ ] **备份恢复**: 数据备份和恢复功能

## 🚀 快速开始

### 前置要求
- Go 1.23+
- PostgreSQL 15+
- Redis 7+
- 8GB+ RAM (推荐)
- 50GB+ 存储空间

### 安装步骤

1. **克隆项目**
```bash
git clone <repository-url>
cd nsfw-go
```

2. **环境配置**
```bash
# 复制配置文件
cp configs/config.example.yaml config.yaml

# 编辑配置文件 (数据库密码、媒体路径等)
vim config.yaml
```

3. **启动基础服务**
```bash
# 启动数据库和Redis (如果使用Docker)
make services-up

# 或手动启动PostgreSQL和Redis服务
systemctl start postgresql redis
```

4. **数据库初始化**
```bash
# 执行数据库迁移
make migrate

# 添加初始数据 (可选)
make seed
```

5. **构建和启动应用**
```bash
# 构建应用
make build

# 启动API服务
make run

# 或后台运行
nohup ./nsfw-go &
```

6. **访问系统**
- 🌐 **主页**: http://localhost:8080
- 🔍 **搜索中心**: http://localhost:8080/search.html
- 📊 **本地影视库**: http://localhost:8080/local-movies.html
- 🏆 **排行榜**: http://localhost:8080/rankings.html
- ✅ **健康检查**: http://localhost:8080/health

## 🛠️ 开发指南

### 项目结构
```
nsfw-go/
├── cmd/                    # 应用入口
│   └── api/               # API服务器
├── internal/              # 内部包
│   ├── api/              # API路由和处理器
│   ├── config/           # 配置管理
│   ├── database/         # 数据库连接
│   ├── model/            # 数据模型
│   ├── repo/             # 数据访问层
│   └── service/          # 业务逻辑层
├── migrations/           # 数据库迁移文件
├── scripts/             # 工具脚本
├── web/                 # 前端资源
│   └── dist/           # 构建后的前端文件
├── configs/            # 配置文件
├── docker-compose.yml  # Docker服务配置
├── Makefile           # 构建和管理命令
└── go.mod             # Go模块依赖
```

### 常用命令
```bash
# 开发相关
make dev          # 开发模式启动 (热重载)
make build        # 构建应用
make test         # 运行测试
make clean        # 清理构建文件

# 数据库相关
make migrate      # 执行数据库迁移
make migrate-down # 回滚数据库迁移
make seed         # 添加初始数据
make db-reset     # 重置数据库

# 服务管理
make services-up     # 启动基础服务 (PostgreSQL, Redis)
make services-down   # 停止基础服务
make services-status # 检查服务状态
make logs           # 查看应用日志

# 部署相关
make docker-build   # 构建Docker镜像
make deploy        # 生产环境部署
```

### API开发规范
- 使用RESTful设计原则
- 统一的错误响应格式
- 请求参数验证
- 分页查询支持
- 适当的HTTP状态码

### 数据库设计原则
- 外键约束确保数据完整性
- 索引优化查询性能
- 软删除支持数据恢复
- 审计字段记录操作历史

## 🔧 配置说明

### 环境变量
```bash
# 数据库配置
NSFW_DATABASE_HOST=localhost
NSFW_DATABASE_PORT=5432
NSFW_DATABASE_USER=nsfw
NSFW_DATABASE_PASSWORD=nsfw123
NSFW_DATABASE_DBNAME=nsfw_db

# Redis配置
NSFW_REDIS_HOST=localhost
NSFW_REDIS_PORT=6379

# 服务器配置
NSFW_SERVER_PORT=8080
NSFW_SERVER_MODE=release

# 媒体库配置
NSFW_MEDIA_BASE_PATH=/MediaCenter/NSFW/Hub/#Done
```

### 主要配置项
```yaml
# config.yaml
server:
  port: 8080
  mode: release

database:
  host: localhost
  port: 5432
  user: nsfw
  password: nsfw123
  dbname: nsfw_db

media:
  base_path: "/MediaCenter/NSFW/Hub/#Done"
  scan_interval: "15m"

crawler:
  javdb_base_url: "https://javdb.com"
  ranking_schedule: "0 12 * * *"  # 每日12:00
  local_check_schedule: "0 * * * *"  # 每小时
```

## 📈 系统特点

### 🎯 设计理念
- **简洁优先**: 移除复杂功能，专注核心体验
- **性能导向**: 毫秒级响应，流畅的用户体验
- **数据驱动**: 基于真实数据的智能分析
- **用户友好**: 直观的界面，简单的操作流程

### 🚀 技术优势
- **高性能**: 数据库缓存 + 定时任务，避免实时扫描
- **可扩展**: 模块化设计，易于添加新功能
- **稳定可靠**: Go语言的并发特性，稳定的服务运行
- **现代化**: 响应式设计，适配各种设备

### 📊 数据统计
- **本地影片**: 498部已扫描影片
- **排行榜数据**: 每日更新的多类型排行榜
- **搜索响应**: ~1秒的在线搜索响应时间
- **系统性能**: 3ms的API平均响应时间

## 🤝 贡献指南

### 开发环境设置
1. Fork项目到个人仓库
2. 克隆到本地开发环境
3. 安装Go 1.23+和相关依赖
4. 配置数据库和Redis连接
5. 运行`make dev`启动开发服务器

### 代码提交规范
- 使用语义化的commit message
- 提交前运行测试确保功能正常
- 保持代码风格一致
- 添加必要的注释和文档

### Pull Request流程
1. 创建功能分支进行开发
2. 完成开发后提交Pull Request
3. 通过代码审查后合并到主分支
4. 部署到测试环境验证功能

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 🔗 相关链接

- [Go官方文档](https://golang.org/doc/)
- [Gin Web框架](https://gin-gonic.com/)
- [GORM文档](https://gorm.io/)
- [PostgreSQL文档](https://www.postgresql.org/docs/)
- [Tailwind CSS](https://tailwindcss.com/)

---

**🎬 NSFW-Go - 让影视库管理变得简单高效！** 